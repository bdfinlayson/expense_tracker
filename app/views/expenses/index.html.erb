<h1>Expenses</h1>
<h3>Displaying <%= @total_items %> Expenses</h3>

<table>
  <tr>
    <td>This Month</td>
    <td>Last Month</td>
    <td>% Change over Last Month</td>
    <td>Displayed Expenses</td>
    <td>Displayed Vs Total</td>
  </tr>
  <tr>
    <td>
      <%= number_to_currency @total_expenses_this_month %>
    </td>
    <td>
      <%= number_to_currency @total_expenses_last_month %>
    </td>
    <td>
      <%= @percentage_change_over_last_month %>%
    </td>
    <td>
      <%= number_to_currency @total_expenses %>
    </td>
    <td>
      <%= @searched_vs_total %>%
    </td>
  </tr>
</table>



<%= search_form_for @q do |f| %>
  <%= f.label :category_name_or_vendor_name_cont %>
  <%= f.search_field :category_name_or_vendor_name_cont %>
  <%= f.submit %>
<% end %>

<table data-role="table" class="ui-responsive">
  <thead>
    <tr>
      <td class='date-column'>Date</td>
      <td>Amount</td>
      <td>Vendor</td>
      <td>Category</td>
      <td></td>
    </tr>
  </thead>
  <tbody>
    <% @expenses.each do |expense| %>
      <tr class='index-form'>
        <%= form_for expense do |f| %>
          <%= f.text_field :id, type: :hidden, value: expense.id %>
          <%= f.text_field "q[#{@search_query.keys.first}]", type: :hidden, value: @search_query.values.first %>
          <td class='date-column'>
            <div class='row-item'>
              <%= expense.created_at.strftime('%m-%d-%Y') %>
            </div>
            <%= f.date_field :created_at, class: 'created_at' %>
          </td>
          <td>
            <div class='row-item'>
              <%= number_to_currency expense.amount %>
            </div>
            <%= f.text_field :amount, type: :number, step: '0.01', placeholder: '$1.50' %>
          </td>
          <td>
            <div class='row-item'>
              <%= link_to expense.vendor.name, edit_vendor_path(expense.vendor) %>
            </div>
            <%= collection_select(:expense, :vendor_id, Vendor.all, :id, :name, prompt: 'Select a vendor', selected: expense.vendor.id) %>
          </td>
          <td>
            <div class='row-item'>
              <%= link_to expense.category.name, edit_category_path(expense.category) %>
            </div>
            <%= collection_select(:expense, :category_id, Category.all, :id, :name, prompt: 'Select a category', selected: expense.category.id) %>
          </td>
          <td class='form-actions'>
            <div class='edit'>&#9998;</div>
            <div class='cancel'>&#9995;</div>
            <div class='update'>&#10003</div>
            <div class='delete'><%= link_to 'X', {action: :destroy, id: expense.id, expense: { q: { category_name_or_vendor_name_cont: @search_query.values.first }}}, method: :delete, data: { confirm: 'Are you sure?'} %></div>
            <div class='update-btn'><%= f.submit %></div>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>


